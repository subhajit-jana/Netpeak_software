function addHashAndScrollToElement(t,e,n){var o=$("#"+t+"_area"),n=n||0;history.pushState?history.pushState(null,null,"#"+t):location.hash="#"+t,goToSection(o,headerH+n,null,scrollSpeed),e&&setTimeout(function(){tempHighlight(o,highlightClass,highlightDuration)},animationWaiting)}function analyticSharePost(t){var e=mappingWordsSocial[t];window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Click Button | Share | "+postId+" | "+e,eventLabel:"Blog  | Post",eventValue:"none","eventNon-interaction":"false"})}function analyticUpVotePost(){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Click Button | Like |"+postId,eventLabel:"Blog",eventValue:"none","eventNon-interaction":"false"})}function analyticMorePost(){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Click Button | Show More",eventLabel:"Blog",eventValue:"none","eventNon-interaction":"false"})}function analyticSortingPost(t){var e=mappingWords[sortingPost]+" → "+mappingWords[t];window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Blog: Post Sorting | "+e,eventLabel:"Blog",eventValue:"none","eventNon-interaction":"false"})}function analyticSortingComment(t){var e=mappingWords[sortingComment]+" → "+mappingWords[t];window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Blog: Comment Sorting | "+e,eventLabel:"Blog",eventValue:"none","eventNon-interaction":"false"})}function analyticShareComment(t){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Blog Comment: Share | "+t,eventLabel:"Blog",eventValue:"none","eventNon-interaction":"false"})}function analyticUpVoteComment(t){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Click Button | Like Comment |"+postId,eventLabel:"Blog",eventValue:"none","eventNon-interaction":"false"})}function analyticComplaintComment(t){""==user&&(user=getCookie("anonymous_user")),""==user&&(user="(not set)"),window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Blog Comment: Complain | "+t,eventLabel:"Blog",eventValue:"none","eventNon-interaction":"false"})}function analyticAddComment(){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Click Button | Add Comment |"+postId,eventLabel:"Blog",eventValue:"none","eventNon-interaction":"false"})}function analyticReplyComment(t){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Blog Comment: Reply | "+t,eventLabel:"Blog",eventValue:"none","eventNon-interaction":"false"})}function analyticSubscribeNewsLetter(){window.dataLayer=window.dataLayer||[],dataLayer.push({event:"autoEvent",eventCategory:"Interest",eventAction:"Click Button | Subscribe",eventLabel:"Blog",eventValue:"none","eventNon-interaction":"false"})}var headerH=$("#header").outerHeight(),scrollSpeed=1e3,animationWaiting=scrollSpeed+100,scrollDelay=200,highlightClass="highlight-animation",highlightDuration=3e3,sendingClass="sending",sortingActiveClass="active",sortingDisabledClass="disabled",$BODY=$("body");$(".anonymous-user-modal").on("show.bs.modal",function(){var t=$(this).find(".registration-link div").data("reg-url"),e=$(this).find(".registration-link div").data("reg-button-text");$(this).find(".registration-link span").html('<a href="'+t+'" class="btn btn-success btn_fixed_width_long">'+e+"</a>");var n=$(this).find(".login-link div").data("login-url"),o=$(this).find(".login-link div").data("login-button-text");$(this).find(".login-link span").html('<a style="border-width: 2px; padding-top: 5px; padding-bottom: 5px;" href="'+n+'" class="btn btn-success__reverse btn_fixed_width_long">'+o+"</a>")}),$BODY.on("click",".subscribe-on-newsletter",function(){$.ajax({url:Routing.generate("api.user_email_settings.blog.form_handle"),type:"POST",success:function(t){if(t.isSuccess){window.toastr.success(t.message,"",{positionClass:"toast-bottom-right"});var e=$(".left-menu__subscribe-block");e.next(),e.remove(),$(".bg-engagement").remove(),analyticSubscribeNewsLetter()}},error:function(t){var e=JSON.parse(t.responseText);window.toastr.error(e.errors,"",{positionClass:"toast-bottom-right"})}})});var mappingWordsSocial={facebook:"Facebook",twitter:"Twitter","google-plus":"Google Plus",linkedin:"Linkedin","copy-link":"Copy Link"},mappingWords={read_sort:"unread first",date_desc:"new first",date_asc:"old first"},sortingPost=$(".post-sorting.active").data("sorting"),sortingComment=$(".comment-sorting.active").data("sorting");$DOCUMENT.ready(function(){function t(){d=!0,u=!1,$.post(g,{type:type,sortType:l,categorySlug:categorySlug,postSlug:postSlug,authorId:authorId,countNonReaded:countNonReaded,countReaded:countReaded,countPost:countPost,countPosts:countPosts,superPostSlug:superPostSlug,postsIds:postsIds},function(t){o.removeClass("disabled requesting"),a.hide(),countNonReaded=Number(countNonReaded)+Number(t.countNonReaded),countReaded=Number(countReaded)+Number(t.countReaded),countPost=Number(countPost)+Number(t.countPost),countPosts=t.countPosts,postsIds=t.postsIds;var e="";$(t.view).each(function(t){if(void 0!==$(this).data("post-slug")){var n=$('[data-post-slug="'+$(this).data("post-slug")+'"]');n.length>0&&(e+='[data-post-slug="'+$(this).data("post-slug")+'"],',n.addClass("post-tile--read"),n.attr("data-post-slug","newID"))}}),n.append(t.view),e=e.substring(0,e.length-1),n.find(e).remove(),c&&o.hide(),t.showMorePost||(u=!0),d=!1},"JSON")}var e=$("#footer"),n=$(".tile-block"),o=$(".show-more__btn"),a=$("#loading"),s=$("#post-current-choice"),i=$(".post-sorting"),r=$("#post-dropdown-toggle"),l=s.data("current-sorting"),c=!1,d=!1,u=!1,m=Routing.generate("blog.post.sort"),g=Routing.generate("blog.post.more");o.click(function(e){e.preventDefault(),c=!0,o.addClass("disabled requesting"),t(),analyticMorePost()}),i.on("click",function(){var t=$(this);t.hasClass(sortingActiveClass)||(i.removeClass(sortingActiveClass),t.addClass(sortingActiveClass),l=t.data("sorting"),s.attr("data-current-sorting",l).text(t.text()),r.addClass(sortingDisabledClass),$.post(m,{sortType:l,categorySlug:categorySlug,authorId:authorId,countPost:0,superPostSlug:superPostSlug},function(t){n.empty().html(t.view),r.removeClass(sortingDisabledClass),c=!1,o.show(),countNonReaded=t.countNonReaded,countReaded=t.countReaded,countPost=t.countPost,analyticSortingPost(l),sortingPost=l},"JSON"))}),$WINDOW.scroll(function(){!c||d||u||e.offset().top-$WINDOW.height()<=$WINDOW.scrollTop()&&(a.css("display","inline-block"),t())});var p=[];$("body").on("mousedown",".post-a",function(){var t=$(this).parent("div"),e=t.data("post-slug");if(-1==p.indexOf(e)){p.push(e);var n=t.data("post-readed-type"),o=t.data("post-recomended-group");countNonReaded=Number(countNonReaded)-1;var a=countPosts.replace(/&quot;/g,'"');if(""==a)return;var s=JSON.parse(a);s[n][o]=s[n][o]-1,countPosts=JSON.stringify(s)}})}),$DOCUMENT.ready(function(){function t(t,e){t.setOption("mode","htmlmixed");var n=m.indexOf(e);if(void 0!==e&&-1==n){m.push(e);var o="/vendor_js/codemirror/mode/"+e+"/"+e+".js",a=document.createElement("script");a.src=o,document.head.appendChild(a),t.setOption("mode",e)}}function e(t,e,n,o){var a,s,i,r=window.showModalDialog?"dialog":"",l=!0===e||!0===n,c=e||600,d=n||500;l?(s=0,i=0,c=screen.width,d=screen.height):(s=window.screenX+screen.width/2-c/2-10,i=window.screenY+screen.height/2-d/2-40-5);var u=["toolbar=no","location=no","directories=no","status=no","menubar=no","scrollbars=no","resizable=no","copyhistory=no","center=yes",r+"width="+c+"px",r+"height="+d+"px",r+"top="+i+"px",r+"left="+s+"px"],m=function(t){t&&(a=t.document.createElement("div"),a.style.cssText="top:0;right:0;bottom:0;left:0;position:absolute;z-index:50000;",a.onclick=function(){return t.focus&&t.focus(),!1},window.top.document.body.appendChild(a))},g=function(){a&&(a.onclick=null,a.parentNode.removeChild(a),a=null)},p=window.open(t,"",u.join(","));l&&p.moveTo(0,0);var v=function(){m(this)},h=function(){window.clearInterval(f),o&&o(),g()};if(p){var f=window.setInterval(function(){try{(null==p||p.closed)&&h()}catch(t){}},500);p.addEventListener?p.addEventListener("load",v,!1):p.attachEvent("load",v)}}!function(){var t=$(".post-content img");$.each(t,function(t,e){var n=$(e);!0!==n.hasClass("post-content__author-img")&&!0!==n.parent("div").hasClass("post-content__img")&&void 0===n.parent("a").html()&&(n.addClass("pointer"),n.addClass("fancybox"),n.attr("data-fancybox","images"),n.attr("href",n.attr("src")),void 0===n.attr("data-caption")&&n.attr("data-caption",n.attr("alt")))})}();var n=!1,o=$(".post-upvote"),a=$(".post-vote-counter"),s=$("#unread-post-button");s.removeClass("hide");var i=Routing.generate("blog.post.vote"),r=Routing.generate("blog.share.result"),l=Routing.generate("blog.post.metric"),c=Routing.generate("blog.post.socialMetricActivity"),d=$(".subscribe-post-comment"),u=Routing.generate("blog.post.commentSubscribe");""!=postSlug&&($.post(l,{slug:postSlug},function(t){if(""!=t){var e=t.data.filter;for(filter in e)0==e[filter]?$("#count-"+filter).remove():$("#count-"+filter).html(e[filter]);var n=t.data.category;for(category in n)0==n[category].countNonReaded?$("#count-"+n[category].slug).remove():$("#count-"+n[category].slug).html(n[category].countNonReaded)}},"JSON"),$.get(c+"/"+postSlug,{},function(t){var e=t.data;for(activity in e)!0===e[activity]&&$("."+activity).addClass("selected")},"JSON"),$WINDOW.scroll(function(){if($("*").is(".js-recommendBlock")){var t=$(".js-recommendBlock").offset().top-410,e=$(".js-blockPosition");$(this).scrollTop()>t?e.css({position:"absolute",top:t+90}):e.css({position:"fixed",top:"auto"})}})),$("#post").on("click",".not_logged_post-upvote",function(){analyticUpVotePost()}),$("#post").on("click",".post-upvote",function(){analyticUpVotePost(),$(this).hasClass(sendingClass)||(o.addClass(sendingClass),$.post(i,{slug:postSlug},function(t){a.empty().html("<span>"+t.countVote+"</span>"),o.removeClass("post-upvote "+sendingClass).addClass("reverse disable"),o.addClass("selected")},"JSON"))}),$(".share").on("click",function(){if(!0!==n){n=!0;var t=$(this).data("social-network"),o=$("."+t);o.addClass(sendingClass),analyticSharePost(t);var a=JSON.parse(shareUrls.replace(/&quot;/g,'"'))[t];a=a.replace(/&#039;/g,"'"),a=a.replace(/amp;/g,""),e(a,500,500,function(){$.ajax({url:r,type:"POST",data:{socialNetwork:t,postSlug:postSlug},success:function(e){o.removeClass(sendingClass),$(".share-total-counter").empty().html(e.count),n=!1,$("."+t).addClass("selected")},error:function(t){o.removeClass(sendingClass),n=!1}})})}}),$("#unread-post-form").submit(function(t){t.preventDefault();var e=$(this);s.attr("disabled","disabled").addClass(sendingClass),$.ajax({url:e.attr("action"),type:"POST",data:e.serialize(),success:function(t){window.location.href=t.url}})}),$("body").on("click","#modal-share .copy-button",function(t){t.preventDefault(),analyticSharePost("copy-link")});var m=[];$(".code-example").each(function(){var e=$(this),n=e.data("mode"),o=e.text();e.empty(),t(CodeMirror(this,{value:o,lineNumbers:!0,matchBrackets:!0,lineWrapping:!0,readOnly:!0}),n)}),d.on("click",function(){var t,e=$(this);e.is(":checked")?(d.prop("checked",!1),e.prop("checked",!0),t=e.data("option")):t=3,d.prop("disabled",!0),$.post(u,{slug:postSlug,type:t},function(t){d.prop("disabled",!1),window.toastr.success(t.message,"",{positionClass:"toast-bottom-right"})},"JSON")})}),function(){document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector(".js-left-menu-blog");if(t)for(var e=t.querySelectorAll(".left-menu__item a"),n=0;n<e.length;n++)e[n].addEventListener("mouseenter",function(t){var e=t.target,n=e.querySelector(".left-menu__unreaded-count"),o=e.getAttribute("data-blog-hover");e.classList.contains("active")||(e.style.color=o,n&&(n.style.backgroundColor=o))}),e[n].addEventListener("mouseleave",function(t){var e=t.target,n=e.querySelector(".left-menu__unreaded-count");e.classList.contains("active")||(e.removeAttribute("style"),n&&n.removeAttribute("style"))});if(categoryUrl)for(var o=document.querySelectorAll(".left-menu__item"),n=0;n<o.length;n++)if(o[n].classList.contains(categoryUrl)){var a=o[n].querySelector("a"),s=a.querySelector(".left-menu__unreaded-count"),i=a.getAttribute("data-blog-hover");a.classList.add("active"),a.style.color=i,s&&(s.style.backgroundColor=i)}})}(),$DOCUMENT.ready(function(){function t(t,e){var e=e||200;return t.length>e&&(t=t.substring(0,e-3)+"..."),t}var e=$("#header").outerHeight(),n=($(".post-interaction"),$(".post-content")),o=$("#c_area"),a=$("#comments-container"),s=$("#comment_content"),i=($("#social-engagement"),$(".sorting-row")),r=$("#comment-current-choice"),l=$(".comment-sorting"),c=$("#comment-dropdown-toggle"),d=r.data("current-sorting"),u=Routing.generate("blog.comment.order"),m=Routing.generate("blog.comment.vote"),g=Routing.generate("blog.comment.complaint");0===n.length&&(n=$(".post-content__text")),$WINDOW.on("load",function(){if($(".comment-item em").each(function(){var e=$(this),n=t(e.text(),200);e.text(n)}),!checkUndefined(a.html())){var n=location.hash;if(n){var o,s=!1;-1!==n.indexOf("&reply")?(s=!0,o=$(n.slice(0,n.indexOf("&reply"))+"_area")):o=$(n+"_area"),o.length>0&&("#c"===n?(setTimeout(function(){goToSection(o,e,null,scrollSpeed)},scrollDelay),isDesktop()&&setTimeout(function(){o.find("textarea").focus()},animationWaiting+scrollDelay)):-1!==n.indexOf("#toc")?setTimeout(function(){goToSection(o,e+25,null,scrollSpeed)},scrollDelay):(setTimeout(function(){goToSection(o,e+25,null,scrollSpeed)},scrollDelay),setTimeout(function(){tempHighlight(o,highlightClass,highlightDuration),s&&isLoggedIn&&o.find(".comment-reply").trigger("click")},animationWaiting+scrollDelay)))}}}),$(".toc__item").on("click",function(t){addHashAndScrollToElement($(t.currentTarget).data("target"),null,25)}),$(".goto-comments").on("click",function(t){addHashAndScrollToElement($(t.currentTarget).data("target")),isDesktop()&&setTimeout(function(){s.focus()},animationWaiting)}),a.on("click",".comment-item .comment-item__quote",function(t){if("a"!==t.target.tagName.toLowerCase()){var e=$(t.currentTarget),n=e.data("go-to");if(n)location.assign(n);else{addHashAndScrollToElement(e.data("target"),!0,25)}}}),a.on("click",".comment-reply",function(){var t=$(this),e=t.parents(".comment-item"),n=$("#template").clone();if(analyticReplyComment(document.location.href.split("#")[0]+"#"+e[0].id.split("_")[0]),n.length){var o=e.data("comment");t.hasClass("active")||(t.addClass("active"),n.attr("id",o+"_child").addClass("comment-reply-form"),n.find("textarea").val("").removeAttr("id style").after('<input type="hidden" name="parentId" value="'+o+'">'),n.find(".comment-btn--cancel").data("parent",o),n.find('button[type="submit"]').attr("disabled","disabled"),e.after(n),n.slideDown(400,function(){n.find("textarea").focus()}))}else{var a=e.find(".comment-share").data("clipboard-text")+"&reply";if(t.data("toggle")){var s=$(".loginUrl-reply-comment"),i=$(".registrationUrl-reply-comment"),r=encodeURIComponent(a);s.data("login-url",s.data("login-url")+r),i.data("reg-url",i.data("reg-url")+r)}else location.assign(a)}}),a.on("click",".comment-btn--cancel",function(){var t=$(this),e=t.parents(".comment-reply-form");$("#c-"+t.data("parent")+"_area").find(".comment-reply").removeClass("active"),e.slideUp(400,function(){e.remove()})}),$("body").on("click",".add-comment-singout",function(t){analyticAddComment()}),$("body").on("submit",".add-comment-form",function(e){e.preventDefault(),analyticAddComment();var n=$(this),o=n.parents(".comment-reply-form"),s=n.find('button[type="submit"]'),r=n.find(".comment-btn--cancel");s.attr("disabled","disabled").addClass(sendingClass),r.attr("disabled","disabled");$("input[name=parentId]").val();$.ajax({url:n.attr("action"),type:"POST",data:n.serialize(),success:function(e){var l=e.view,c=l.indexOf("_area"),u=l.substring(c-8,c),m=e.parent;if(""==m)l='<div class="comment-thread">'+l+"</div>","date_asc"===d&&a.append(l),"date_desc"===d&&a.prepend(l);else{var g=$('[data-comment="'+m+'"]');g.data("comment-root")?(l='<div class="comment-thread__last-lvl">'+l+"</div>",g.parents(".comment-thread__second-lvl").append(l)):(l='<div class="comment-thread__second-lvl">'+l+"</div>",g.parents(".comment-thread").append(l))}var p=$("#c-"+u+"_area"),v=t(p.find(".comment-item__quote em").text(),200);p.find(".comment-item__quote em").text(v),s.removeClass(sendingClass),r.removeAttr("disabled"),$("#c-"+r.data("parent")+"_area").find(".comment-reply").removeClass("active"),n.find("textarea").val("").height("auto"),o.remove(),i.show(),$(".no-content").hide(),$(".post-comment-counter").empty().html("<span>"+e.commentCount+"</span>"),addHashAndScrollToElement("c-"+u,!0,25),$(".comment").addClass("selected")},error:function(t){s.removeClass(sendingClass).removeAttr("disabled"),r.removeAttr("disabled");var e=t.responseJSON.error;for(variable in e)window.toastr.error(e[variable],"",{positionClass:"toast-bottom-right"})}})}),$("body").on("keydown",".add-comment-form",function(t){"disabled"!=$(this).find(".comment-btn").attr("disabled")&&t.ctrlKey&&13===t.keyCode&&$(this).submit()}),o.on("input",".add-comment-form textarea",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px";var t=$(this),e=t.parents("form").find('button[type="submit"]');t.val().length?e.removeAttr("disabled"):e.attr("disabled","disabled")}),l.on("click",function(){var t=$(this);t.hasClass(sortingActiveClass)||(d=t.data("sorting"),c.addClass(sortingDisabledClass),$.post(u,{slug:postSlug,userId:userId,type:d},function(e){l.removeClass(sortingActiveClass),t.addClass(sortingActiveClass),r.attr("data-current-sorting",d).text(t.text()),a.empty().html(e.view),c.removeClass(sortingDisabledClass),analyticSortingComment(d),sortingComment=d},"JSON"))}),a.on("click",".up-vote",function(){var t=$(this),e=t.parents(".comment-vote");if(!e.hasClass(sendingClass)){e.addClass(sendingClass);var n=t.parents(".comment-item").data("comment"),o=e.find(".comment-vote-counter");analyticUpVoteComment(t.parents(".comment-item").find(".comment-share").data("clipboard-text")),$.post(m,{identifyComment:n},function(n){o.empty().html(n.countVote).addClass("m-r-1"),t.removeClass("up-vote"),e.addClass("text-menu-link").removeClass(sendingClass+" up-vote--wrap")},"JSON")}}),a.on("click",".up-vote-anonymous",function(){var t=$(this),e=encodeURIComponent($(this).parents(".comment-item").find(".comment-share").data("clipboard-text")),n=$(".loginUrl-vote-comment"),o=$(".registrationUrl-vote-comment");analyticUpVoteComment(t.parents(".comment-item").find(".comment-share").data("clipboard-text")),n.data("login-url",n.data("login-url")+e),o.data("reg-url",o.data("reg-url")+e)}),a.on("click",".add-complaint",function(){var t=$(this),e=t.parents(".comment-complaint");if(!e.hasClass(sendingClass)){e.addClass(sendingClass);var n=t.parents(".comment-item").data("comment"),o=t.parents(".comment-item"),a=t.parents(".point-menu"),s=o.find(".comment-share").data("clipboard-text");$.post(g,{identifyComment:n},function(e){t.remove(),0===a.find("li").length&&a.remove(),window.toastr.info(e.message,"",{positionClass:"toast-bottom-right"}),analyticComplaintComment(s)},"JSON")}}),$("body").on("click",".comment-share",function(t){t.preventDefault(),analyticShareComment($(this).data("clipboard-text"))})}),$DOCUMENT.ready(function(){var t=$(".comments-of-author");$(".custom-tabs span").on("click",function(){var t=$(this).data("new-hash"),e=$("#commentSorting"),n=$("#postSorting");"comments"===t&&(n.addClass("hide"),e.removeClass("hide")),"posts"===t&&(e.addClass("hide"),n.removeClass("hide")),history.pushState?history.pushState(null,null,"#"+t):location.hash="#"+t}),location.hash.indexOf("=")&&t.trigger("click"),$WINDOW.on("load",function(){var e=$(".author__switchers"),n=$(".tab-content"),o=$('span[data-target="'+location.hash+'-of-author"]');o.length>0?o.trigger("click"):t.trigger("click"),e.removeClass("hide"),n.removeClass("hide")})});